<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard | Architecture Diagram Generator</title>
    <link rel="stylesheet" href="static\styles.css">
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10.8.0/dist/mermaid.min.js"></script>
</head>
<body>

    <div class="dashboard-container">
        <!-- Sidebar Navigation -->
        <aside class="sidebar">
            <h2>C to A</h2>
            <nav>
                <ul>
                    <li><a href="#dashboard">Dashboard</a></li>
                    <li><a href="#upload">Upload Codebase</a></li>
                    <li><a href="#architecture">View Architecture</a></li>
                    <li><a href="#export">Export Diagrams</a></li>
                </ul>
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Dashboard Section -->
            <section id="dashboard">
                <h1>Codebase Analysis Dashboard</h1>
            </section>

            <!-- Folder Upload Section -->
            <section id="upload">
                <h2>Upload Codebase Folder</h2>
                <div class="upload-box">
                    <p>Drag & Drop your codebase folder here or</p>
                    <input type="file" id="folder-upload" webkitdirectory directory multiple onchange="handleFolderUpload(event)">
                    <label for="folder-upload" class="upload-btn">Choose Folder</label>
                </div>
            </section>

            <!-- Architecture Diagram Generator -->
            <section id="architecture">
                <h2>Code Analysis Results</h2>
                <div id="loading" class="loading" style="display: none;">
                    <p>Analyzing code... This may take a moment.</p>
                </div>
                <div id="code-analysis-results" style="display: none;">
                    <div id="code-diagram" class="diagram-container"></div>
                </div>
            </section>

            <!-- Export Section -->
            <section id="export">
                <button class="export-btn">Export Diagram</button>
            </section>
        </main>
    </div>

    <script>
        // Initialize Mermaid
        mermaid.initialize({
            startOnLoad: true,
            theme: 'default',
            securityLevel: 'loose',
            flowchart: {
                useMaxWidth: false,
                htmlLabels: true,
                curve: 'basis'
            },
            maxTextSize: 50000,
            fontSize: 14
        });

        // Handle folder upload and trigger analysis
        function handleFolderUpload(event) {
            const files = event.target.files;
            if (files.length > 0) {
                // Simulate analyzing the uploaded folder
                analyzeCode(files);
            }
        }

        async function analyzeCode(files) {
            document.getElementById('loading').style.display = 'block';
            document.getElementById('code-analysis-results').style.display = 'none';

            try {
                // Simulate an API call to analyze the folder
                const folderData = Array.from(files).map(file => file.webkitRelativePath);
                const response = await fetch('/analyze', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ folder: folderData }) // Send folder structure
                });
                const data = await response.json();

                if (data.error) {
                    alert(`Error: ${data.error}`);
                    document.getElementById('loading').style.display = 'none';
                    return;
                }

                // Display the analyzed diagram
                document.getElementById('code-diagram').innerHTML = `<div class="mermaid">${data.graph_code}</div>`;
                await mermaid.run();

                document.getElementById('loading').style.display = 'none';
                document.getElementById('code-analysis-results').style.display = 'block';
            } catch (error) {
                alert(`Error analyzing code: ${error.message}`);
                document.getElementById('loading').style.display = 'none';
            }
        }
    </script>
    <script src="C:\Visual Code\Micro\CDB-archtool\static\js\dashboard.js"></script>
</body>
</html>